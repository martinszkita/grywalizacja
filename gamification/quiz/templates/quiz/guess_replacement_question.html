{% extends 'base.html' %}
{% block content %}
  <div class="text-center mb-5">
    <h2 class="fw-semibold text-primary mb-2">Pytanie <span class="fw-bold">{{ question_num }}</span> z {{ question_count }}</h2>

    <p class="text-muted fs-5 fst-italic">Czy w poni≈ºszym zdaniu zosta≈Ço zamienione jakie≈õ s≈Çowo?</p>
  </div>

  <h1 class="quiz-sentence text-center mb-5">{{ sentence }}</h1>

  <form method="post" class="text-center">
    {% csrf_token %}

    <!-- Opcje TAK/NIE -->
    <div class="d-flex flex-wrap justify-content-center gap-3 mb-4">
      {% for value, label in form.fields.answer.choices %}
        <div>
          <input type="radio" class="btn-check" name="answer" id="opt{{ forloop.counter }}" value="{{ value }}" />
          <label class="btn btn-outline-primary btn-lg px-4 py-3 fs-4 shadow-sm" for="opt{{ forloop.counter }}">{{ label }}</label>
        </div>
      {% endfor %}
    </div>

    <!-- üîΩ Sekcja z kafelkami ‚Äì ukryta na start -->
    <div id="wordButtonsSection" class="collapse">
      <div class="mt-4">
        <p class="fs-5 text-muted">Wybierz s≈Çowo, kt√≥re zosta≈Ço zamienione:</p>
        <div class="d-flex flex-wrap justify-content-center gap-3 mt-3">
          {% for word in sentence.split %}
            <button type="button" class="btn btn-outline-info btn-lg word-btn shadow-sm">{{ word }}</button>
          {% endfor %}
        </div>
      </div>
    </div>

    <script>
        const words = [{% for word in sentence.split %}"{{ word }}"{% if not forloop.last %}, {% endif %}{% endfor %}];
        console.log("Lista s≈Ç√≥w:", words);
    </script>


    <input type="hidden" name="chosen_word" id="chosen_word" value="" />

    <!-- "Dodaj notatkƒô" -->
    <div class="d-flex justify-content-center mt-4">
      <button class="btn btn-outline-secondary btn-lg py-3 fs-5" type="button" data-bs-toggle="collapse" data-bs-target="#noteBox">‚ûï Dodaj notatkƒô</button>
    </div>

    <div class="collapse justify-content-center" id="noteBox">
      <div class="card card-body border-0 shadow-sm mt-3">{{ form.user_comment.label_tag }}
        {{ form.user_comment }}</div>
    </div>

    <!-- Submit -->
    <div class="d-flex justify-content-center mt-4">
      <button type="submit" class="btn btn-success btn-lg px-5 shadow">Nastƒôpne pytanie</button>
    </div>
  </form>

  <!-- üí° JavaScript do pokazywania sekcji po klikniƒôciu "TAK" -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const radios = document.querySelectorAll('input[name="answer"]')
      const buttonsSection = document.getElementById('wordButtonsSection')
    
      radios.forEach((radio) => {
        radio.addEventListener('change', () => {
          const collapseInstance = new bootstrap.Collapse(buttonsSection, {
            toggle: false
          })
          if (radio.value.toLowerCase() === 'tak') {
            collapseInstance.show()
          } else {
            collapseInstance.hide()
          }
        })
      })
    
      // üí¨ Dodatkowo: klikniƒôcie w kafelek go pod≈õwietla (jak wyb√≥r)
      document.querySelectorAll('.word-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.word-btn').forEach((b) => b.classList.remove('active'))
          btn.classList.add('active')
        })
      })
    
      // üí¨ Po klikniƒôciu kafelka zapisz jego tekst do ukrytego pola
      const hiddenInput = document.getElementById('chosen_word')
    
      document.querySelectorAll('.word-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          // Usu≈Ñ poprzednie zaznaczenie
          document.querySelectorAll('.word-btn').forEach((b) => b.classList.remove('active'))
          // Zaznacz klikniƒôty
          btn.classList.add('active')
          // Wpisz jego tekst do ukrytego inputa
          hiddenInput.value = btn.textContent.trim()
          console.log('Wybrane s≈Çowo:', hiddenInput.value)
        })
      })
    })
  </script>

  <style>
    /* Efekt zaznaczenia przycisku */
    .word-btn.active {
      background-color: #0d6efd;
      color: white;
      box-shadow: 0 0 10px rgba(13, 110, 253, 0.5);
      transform: scale(1.05);
    }
    .word-btn {
      transition: all 0.2s ease;
    }
  </style>
{% endblock %}
